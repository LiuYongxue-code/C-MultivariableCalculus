
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{sectionheadings}[2018/10/12 sectionheadings package]
\RequirePackage{ctex}
\RequirePackage{fontspec}
\RequirePackage[explicit,calcwidth]{titlesec} 

% 章节格式和字体设置
% ***********************************************************
% 章设置chapter
% ===========================================================
\newcommand*\chapterlabel{}
\titleformat{\chapter}
  {\gdef\chapterlabel{}
  \CJKfontspec{方正隶书_GBK}\bfseries\Huge}
  {\gdef\chapterlabel{\thechapter\ }}{0pt}
  {\begin{tikzpicture}[remember picture,overlay]
    \node[yshift=-3cm] at (current page.north west)
      {\begin{tikzpicture}[remember picture, overlay]
        \draw[fill=softblue] (0,0) rectangle
          (\paperwidth,3cm);
        \node[anchor=east,xshift=.9\paperwidth,rectangle,
              rounded corners=20pt,inner sep=11pt,
              fill=MidnightBlue]
              {\color{white}\chapterlabel#1};
       \end{tikzpicture}
      };
   \end{tikzpicture}
  }
\titlespacing*{\chapter}{0pt}{50pt}{-60pt}

% 节设置section
% ============================================================
\setcounter{secnumdepth}{4}
\titleformat{\section}
  {\addtolength{\titlewidth}{2pc}\CJKfontspec{方正隶书_GBK}\Large\bfseries}
  {\colorbox{MidnightBlue}{\parbox{20mm}{\strut\color{white}\hfill\thesection}}}
  {1em}{#1}
  [{\titleline*[l]{\color{MidnightBlue}\titlerule[2pt]}}]

% 子节设置subsection
% ============================================================
\titleformat{\subsection}
  {\addtolength{\titlewidth}{2pc}\CJKfontspec{方正隶书_GBK}\bfseries\large\scshape}
  {\colorbox{MidnightBlue}{\parbox{20mm}{\strut\color{white}\hfill\thesubsection}}}
  {1em}{#1}
  [{\titleline*[l]{\color{MidnightBlue}\titlerule[2pt]}}]
\titleformat{\subsubsection}
  {\addtolength{\titlewidth}{2pc}\normalfont\CJKfontspec{方正隶书_GBK}\bfseries}
  {\colorbox{MidnightBlue}{\parbox{12mm}{\strut\color{white}\thesubsubsection}}}
  {1em}{#1}
  [{\titleline*[l]{\color{MidnightBlue}\titlerule[2pt]}}]
\titleformat{\paragraph}
  {\addtolength{\titlewidth}{2pc}\CJKfontspec{方正隶书_GBK}\bfseries\large\sffamily}
  {\colorbox{MidnightBlue}{\parbox{14mm}{\strut\color{white}\theparagraph}}}
  {1em}{#1}
  [{\titleline*[l]{\color{MidnightBlue}\titlerule[2pt]}}]